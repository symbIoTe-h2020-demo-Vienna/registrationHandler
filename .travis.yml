language: java

env:
  global:
    secure: "qdOBjRUwPUf2Rdw3wJfDw6PuKfCZK5WuzNpDPlga/jlYuc/5TDZEU6Xd53g76ahL8O9Ubjvjj5Qa/xY1O7T2r8cNalfg387e2kLGc4ZqmT+RWfngeJPOUyu+B5ta2ihd7q+Yp6sMNpY+kjP7RZiIDU0haowO3AeDyWEc+s01FjbumI8K1HFuv2oAQuZjm3vZr/Ny/3xUgLiZjGxyCaEmbgoARHOH8ruWzNTW6xD83Xjhn42vMy43y8Eo4uGWCZlldOX4MalmZpIvukd4QD7cNCyK+3hJdktkZq95BQtwSimvDm51I7Ygk+33FoYI9HMBYb22OuUMDE4PwIRvoXaKgJDm1V2buOHA6mEF56a1qxOJtXxAq7IsRlv+Oe7MTN9lZAL2SLHwWeQeqJlUeOKlpRtKEtxYrnHkX/f1cvzeRu/oAOsxhmHVxPFdCsmRCxV/6CIBmOtG69Kx55wV3ClGj5iFzz5jFeCzfj4QF67xuWIvS1BuXoo+qXUzZbudvLsA3JxIA2QjTGuPnCFKzlbw3kFzET69aC0d5A8n6C8UFubKzlVx1gg16k03hvNM17mh2DoPvkog9D8gKqxzh4IZ/Pgky68KFZ/YHBhqDQElcLrv/T0BjfhgCBiOr5yzJJUyPh2yQ1F03oI9FhrbSe54w/KALeP05K4aStFFh8MC/u8="

jdk:
- oraclejdk8

services:
  - mongodb
  - rabbitmq

sudo: required

branches:
  only:
  - staging

before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"

after_success:
- chmod a+x merge_script.sh
- BRANCHES_TO_MERGE_REGEX='staging' BRANCH_TO_MERGE_INTO=develop GITHUB_REPO=symbiote-h2020/registrationHandler
  ./merge_script.sh
- bash <(curl -s https://codecov.io/bash)
